# Data Leak Locator — Система Обнаружения Утечек Данных

## 1. Название проекта

**Data Leak Locator** (Локатор Утечек Данных) — многофункциональный инструмент для автоматического обнаружения конфиденциальной информации в файлах, документах и изображениях с возможностью безопасной архивации обнаруженных данных.

---

## 2. Введение

### Цель проекта

Data Leak Locator — это комплексное программное решение для автоматизированного поиска и защиты чувствительных данных в корпоративных и персональных файловых системах. Система предназначена для:

- **Аудита безопасности** — выявление случайно сохранённых паролей, API-ключей, токенов и персональных данных в исходном коде, конфигурационных файлах и документации
- **Соответствия требованиям** — помощь в соблюдении регламентов PCI DSS, GDPR, ФЗ-152 путём обнаружения хранящихся персональных и финансовых данных
- **Защиты данных** — безопасное шифрование и архивация обнаруженных конфиденциальных файлов

### Область применения

| Сфера | Применение |
|-------|------------|
| **DevSecOps** | Интеграция в CI/CD для предотвращения коммитов с секретами |
| **Compliance** | Аудит хранилищ данных перед проверками регуляторов |
| **Forensics** | Анализ файловых систем при расследовании инцидентов |
| **Личное использование** | Поиск и защита персональных документов |

---

## 3. Актуальность / Проблема

### Проблема утечек данных

Согласно исследованиям, **более 80% успешных кибератак** используют скомпрометированные учётные данные. Основные источники утечек:

1. **Захардкоженные секреты** — пароли и API-ключи в исходном коде
2. **Небезопасное хранение** — конфигурационные файлы с открытыми credentials
3. **Случайные коммиты** — загрузка .env файлов и приватных ключей в публичные репозитории
4. **Документы с персональными данными** — сканы паспортов, банковских карт в общих папках

### Ограничения существующих решений

| Проблема | Описание |
|----------|----------|
| **Облачная зависимость** | Большинство решений требуют отправки данных на внешние серверы |
| **Ограниченное покрытие** | Анализ только текстовых файлов без поддержки документов и изображений |
| **Отсутствие локального AI** | Нет возможности интеллектуального анализа без подключения к интернету |
| **Высокая стоимость** | Enterprise-решения недоступны для малого бизнеса и частных лиц |

### Решение

Data Leak Locator работает **полностью локально**, анализирует **все типы файлов** (включая PDF, изображения, архивы) и использует **локальную AI-модель** для интеллектуального анализа угроз.

---

## 4. Цели и задачи

### Основные цели

1. **Создать универсальный сканер** для обнаружения конфиденциальных данных во всех типах файлов
2. **Обеспечить локальную работу** без передачи данных на внешние серверы
3. **Интегрировать AI-анализ** для интеллектуальной оценки рисков
4. **Предоставить инструменты защиты** для безопасного хранения обнаруженных данных

### Задачи проекта

| № | Задача | Статус |
|---|--------|--------|
| 1 | Разработать модуль паттерн-анализа для обнаружения секретов | ✅ Выполнено |
| 2 | Реализовать извлечение текста из PDF, DOCX, XLSX | ✅ Выполнено |
| 3 | Интегрировать OCR-распознавание изображений | ✅ Выполнено |
| 4 | Добавить анализ архивов (ZIP, TAR, GZIP) | ✅ Выполнено |
| 5 | Интегрировать локальную AI-модель (Ollama) | ✅ Выполнено |
| 6 | Разработать модуль AES-256 шифрования | ✅ Выполнено |
| 7 | Создать графический интерфейс пользователя | ✅ Выполнено |
| 8 | Настроить CI/CD для кросс-платформенной сборки | ✅ Выполнено |
| 9 | Написать модульные и интеграционные тесты | ✅ Выполнено |

---

## 5. Архитектура и используемые алгоритмы

### Общая архитектура системы

```
┌─────────────────────────────────────────────────────────────────┐
│                        Data Leak Locator                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│   │  CLI Mode   │  │  GUI Mode   │  │  CI/CD Mode │             │
│   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘             │
│          │                │                │                     │
│          └────────────────┼────────────────┘                     │
│                           ▼                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                   Scanner Core                           │   │
│   │  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐  │   │
│   │  │Pattern Engine │ │ Risk Scorer   │ │ Entropy Calc  │  │   │
│   │  └───────────────┘ └───────────────┘ └───────────────┘  │   │
│   └─────────────────────────────────────────────────────────┘   │
│                           │                                      │
│   ┌───────────────────────┼───────────────────────┐             │
│   │                       ▼                        │             │
│   │  ┌─────────────────────────────────────────┐  │             │
│   │  │           Document Extractor            │  │             │
│   │  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌──────────┐  │  │             │
│   │  │  │ PDF │ │DOCX │ │XLSX │ │ Archives │  │  │             │
│   │  │  └─────┘ └─────┘ └─────┘ └──────────┘  │  │             │
│   │  └─────────────────────────────────────────┘  │             │
│   │                       │                        │             │
│   │  ┌─────────────────────────────────────────┐  │             │
│   │  │          Image Analyzer (OCR)           │  │             │
│   │  │  ┌──────────┐ ┌─────────┐ ┌──────────┐ │  │             │
│   │  │  │Tesseract │ │MRZ Parse│ │Face Detect│ │  │             │
│   │  │  └──────────┘ └─────────┘ └──────────┘ │  │             │
│   │  └─────────────────────────────────────────┘  │             │
│   │                       │                        │             │
│   │  ┌─────────────────────────────────────────┐  │             │
│   │  │         Local AI Analyzer (Ollama)      │  │             │
│   │  └─────────────────────────────────────────┘  │             │
│   └────────────────────────┬──────────────────────┘             │
│                            ▼                                     │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                    Encryptor Module                      │   │
│   │  ┌──────────┐ ┌────────────────┐ ┌──────────────────┐   │   │
│   │  │ AES-256  │ │ Password Gen   │ │  Secure Delete   │   │   │
│   │  └──────────┘ └────────────────┘ └──────────────────┘   │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.1 Анализ текстовых данных

#### Принцип работы

Модуль анализа текста использует **многоуровневый подход** для обнаружения конфиденциальных данных:

**Уровень 1: Паттерн-анализ** (см. Приложение Д.1)

Система содержит библиотеку из 20+ регулярных выражений для обнаружения:

| Категория | Типы данных | Уровень риска |
|-----------|-------------|---------------|
| **Учётные данные** | Пароли, API-ключи, токены, приватные ключи | 🔴 Критический |
| **Облачные сервисы** | AWS Access Key, GitHub Token, Stripe Key | 🔴 Критический |
| **Финансовые данные** | Номера банковских карт, IBAN, BIC | 🔴 Критический |
| **Персональные данные** | Email, телефоны, SSN, номера паспортов | 🟠 Высокий |
| **Конфигурации** | Переменные окружения, строки подключения к БД | 🟠 Высокий |

**Уровень 2: Энтропийный анализ** (см. Приложение Д.2)

Для снижения ложных срабатываний система вычисляет **информационную энтропию** обнаруженных строк:

```
H(X) = -Σ p(x) × log₂(p(x))
```

Где:
- `H(X)` — энтропия строки
- `p(x)` — вероятность появления символа

Строки с высокой энтропией (> 4.5 бит/символ) с большей вероятностью являются реальными секретами.

**Уровень 3: Контекстный анализ**

Система анализирует контекст обнаруженной строки:
- Тип файла (`.env`, `.yaml`, `.json`)
- Ключевые слова рядом (`password`, `secret`, `key`)
- Позиция в структуре данных

**Алгоритм потоковой обработки** (см. Приложение Д.3)

Для эффективной работы с большими файлами используется потоковое чтение:

```
┌──────────────────────────────────────────────────────────────┐
│                  Streaming Scanner Architecture               │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│   ┌─────────┐    ┌──────────────┐    ┌─────────────────┐    │
│   │Directory│───▶│ File Queue   │───▶│  Worker Pool    │    │
│   │ Walker  │    │ (buffered)   │    │ (N goroutines)  │    │
│   └─────────┘    └──────────────┘    └────────┬────────┘    │
│                                               │              │
│                  ┌────────────────────────────┘              │
│                  ▼                                           │
│   ┌──────────────────────────────────────────────────────┐  │
│   │                    Per-File Processing                │  │
│   │  ┌────────────┐  ┌─────────────┐  ┌──────────────┐   │  │
│   │  │ Line-by-   │─▶│  Pattern    │─▶│   Risk       │   │  │
│   │  │ Line Read  │  │  Matching   │  │   Scoring    │   │  │
│   │  └────────────┘  └─────────────┘  └──────────────┘   │  │
│   └──────────────────────────────────────────────────────┘  │
│                                               │              │
│                  ┌────────────────────────────┘              │
│                  ▼                                           │
│   ┌──────────────────────────────────────────────────────┐  │
│   │          Event Stream (findings, progress)            │  │
│   └──────────────────────────────────────────────────────┘  │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

### 5.2 Анализ изображений и документов

#### Извлечение текста из документов

**PDF-файлы:**
1. Попытка извлечения встроенного текста (для текстовых PDF)
2. Конвертация страниц в изображения через `pdftoppm` (для сканированных PDF)
3. OCR-распознавание каждой страницы

**Office-документы (DOCX, XLSX):**
- Распаковка ZIP-контейнера
- Парсинг XML-файлов (`word/document.xml`, `xl/sharedStrings.xml`)
- Извлечение текстовых узлов

**Архивы (ZIP, TAR, GZIP):**
- Рекурсивное сканирование содержимого
- Обнаружение зашифрованных файлов
- Извлечение и анализ вложенных документов

#### OCR-распознавание изображений

Система использует **Tesseract OCR** для распознавания текста на изображениях:

```
┌────────────────────────────────────────────────────────────┐
│                    OCR Processing Pipeline                  │
├────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────┐    ┌──────────────┐    ┌─────────────────┐  │
│   │  Image  │───▶│ Preprocessing │───▶│   Tesseract    │  │
│   │  Input  │    │ (if needed)   │    │   Engine       │  │
│   └─────────┘    └──────────────┘    └────────┬────────┘  │
│                                               │            │
│                                               ▼            │
│   ┌──────────────────────────────────────────────────┐    │
│   │              Text Post-processing                 │    │
│   │  • MRZ detection (паспортная зона)               │    │
│   │  • Keyword extraction                            │    │
│   │  • Date pattern recognition                      │    │
│   └──────────────────────────────────────────────────┘    │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

#### Анализ документов, удостоверяющих личность

Модуль `ImageAnalyzer` использует **многосигнальный подход** для обнаружения документов:

| Сигнал | Вес | Описание |
|--------|-----|----------|
| **MRZ Detection** | 35% | Обнаружение машиночитаемой зоны паспорта |
| **Keywords** | 20% | Поиск ключевых слов ("passport", "паспорт", "surname") |
| **Barcode/QR** | 12% | Обнаружение штрих-кодов (PDF417 для водительских прав) |
| **Face Detection** | 10% | Наличие фото в ожидаемой области |
| **Geometry** | 8% | Соответствие соотношения сторон стандартам документов |
| **Structure** | 10% | Наличие дат, имён, номеров |
| **Quality** | 5% | Разрешение изображения |

**Парсинг MRZ (Machine Readable Zone):** (см. Приложение Д.4)

Система распознаёт и парсит MRZ паспортов в форматах TD1, TD2, TD3:

```
P<UTOERIKSSON<<ANNA<MARIA<<<<<<<<<<<<<<<<<<<
L898902C36UTO7408122F1204159ZE184226B<<<<<10

↓ Парсинг ↓

{
  "type": "P",
  "country": "UTO",
  "surname": "ERIKSSON",
  "given_names": "ANNA MARIA",
  "document_number": "L898902C3",
  "date_of_birth": "740812",
  "sex": "F",
  "expiry_date": "120415"
}
```

### 5.3 Локальная интеграция ИИ

#### Архитектура AI-модуля

Система интегрирована с **Ollama** — платформой для локального запуска LLM:

```
┌────────────────────────────────────────────────────────────┐
│                  Local AI Integration                       │
├────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                 Ollama Server                        │  │
│   │              (localhost:11434)                       │  │
│   │                                                      │  │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐  │  │
│   │  │ llama3.2 │  │ mistral  │  │ llava (vision)   │  │  │
│   │  └──────────┘  └──────────┘  └──────────────────┘  │  │
│   └─────────────────────────────────────────────────────┘  │
│                            │                                │
│                            ▼                                │
│   ┌─────────────────────────────────────────────────────┐  │
│   │               LocalAnalyzer Module                   │  │
│   │                                                      │  │
│   │  • Анализ статистики находок                        │  │
│   │  • Генерация рекомендаций                           │  │
│   │  • Оценка уровня риска                              │  │
│   │  • Визуальный анализ документов (llava)             │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

#### Возможности AI-анализа

**1. Текстовый анализ:**
- Оценка критичности обнаруженных секретов
- Генерация конкретных рекомендаций по устранению
- Приоритизация находок по уровню риска

**2. Визуальный анализ (с моделью llava):**
- Распознавание типа документа на изображении
- Оценка уровня риска утечки
- Описание видимой информации (без конкретных данных)

**Пример промпта для анализа:**

```
Ты эксперт по безопасности. Проанализируй результаты сканирования 
на утечки данных и дай краткие рекомендации на русском языке.

Статистика:
- Всего находок: 47
- Критических: 12
- Высоких: 18
- Средних: 10
- Затронуто файлов: 23
- Средний риск: 67.3

Дай 3-5 конкретных рекомендаций по устранению.
```

#### Преимущества локального AI

| Преимущество | Описание |
|--------------|----------|
| **Конфиденциальность** | Данные не покидают локальную машину |
| **Без подключения к интернету** | Работа в изолированных сетях |
| **Кастомизация** | Возможность дообучения моделей |
| **Отсутствие лимитов** | Нет ограничений API-запросов |

---

## 6. Функция безопасной архивации

### Архитектура модуля шифрования

Модуль `encryptor` обеспечивает защиту обнаруженных конфиденциальных файлов:

```
┌────────────────────────────────────────────────────────────┐
│                    Encryptor Module                         │
├────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                  Encryption Flow                     │  │
│   │                                                      │  │
│   │  Input Files ──▶ ZIP Compression ──▶ AES-256 Enc    │  │
│   │                                                      │  │
│   │        Optional: Secure Delete Originals             │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
│   ┌──────────────────┐  ┌──────────────────────────────┐  │
│   │ Password Policy  │  │     Secure Delete            │  │
│   │                  │  │                              │  │
│   │ • Min 4 chars    │  │ • Multi-pass overwrite       │  │
│   │ • Max 128 chars  │  │ • Pattern: 0x00, 0xFF, rand  │  │
│   │ • Generator      │  │ • 3-10 passes                │  │
│   └──────────────────┘  └──────────────────────────────┘  │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

### Алгоритм шифрования (см. Приложение Д.5)

**Используемый стандарт:** AES-256 в режиме WinZip AE-2

**Процесс шифрования:**

1. **Генерация ключа:**
   - Из пароля пользователя с использованием PBKDF2
   - 256-битный ключ шифрования

2. **Сжатие данных:**
   - DEFLATE-сжатие (уровни 0-9)
   - Уровень 6 по умолчанию (баланс скорость/размер)

3. **Шифрование:**
   - AES-256 в режиме CTR
   - Уникальный IV для каждого файла
   - Проверка целостности (HMAC)

### Безопасное удаление (см. Приложение Д.6)

**Алгоритм многопроходной перезаписи:**

```
Проход 1: Запись 0x00 (нули)
Проход 2: Запись 0xFF (единицы)
Проход 3: Запись случайных данных
... (повтор до N проходов)
Финал: Удаление файла
```

Рекомендуемое количество проходов: **3** (баланс безопасности и скорости)

### Генерация паролей (см. Приложение Д.7)

Модуль включает криптографически безопасный генератор паролей:

```go
// Используемый алфавит
const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+[]{}|;:,.<>?"

// Источник энтропии: crypto/rand (CSPRNG)
```

---

## 7. Пользовательский интерфейс

### Графический интерфейс (GUI)

Приложение предоставляет полнофункциональный GUI на базе **Fyne** — кросс-платформенного UI-фреймворка для Go:

```
┌─────────────────────────────────────────────────────────────────┐
│ 🔍 Поиск Утечек Данных - Сканер Безопасности          [⚙️] [❓] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│ ┌─────────────────┐ ┌───────────────────────┐ ┌───────────────┐ │
│ │ ПАНЕЛЬ УПРАВЛ.  │ │  СПИСОК ФАЙЛОВ       │ │ ДЕТАЛИ ФАЙЛА  │ │
│ │                 │ │                       │ │               │ │
│ │ 📁 Директория   │ │ □ 🔴 config.env      │ │ 📁 config.env │ │
│ │ [____________]  │ │   5 уязвимостей      │ │               │ │
│ │ [📂 Обзор]      │ │                       │ │ [📂 Открыть]  │ │
│ │                 │ │ □ 🟠 api_keys.json   │ │               │ │
│ │ ⚙️ Опции:       │ │   3 уязвимости       │ │ #1 🔴 Пароль  │ │
│ │ □ Документы     │ │                       │ │ Строка 5      │ │
│ │ □ Архивы        │ │ □ 🟡 users.csv       │ │ password=***  │ │
│ │ □ OCR           │ │   8 уязвимостей      │ │               │ │
│ │ □ AI-анализ     │ │                       │ │ #2 🟠 API Key │ │
│ │                 │ └───────────────────────┘ │ Строка 12     │ │
│ │ [▶️ СКАНИРОВАТЬ]│                           │ api_key=****  │ │
│ │ [⏸️] [⏹️] [💾] │ Статистика:               │               │ │
│ │                 │ 🔴 12  🟠 18  🟡 10  🟢 7 │ [📋 Копир.]   │ │
│ │ ━━━━━━━━━━━━━━ │                           │               │ │
│ │ Прогресс: 67%   │ [🔐 Зашифровать выбр.]   │               │ │
│ └─────────────────┘                           └───────────────┘ │
│                                                                  │
│ ✅ Сканирование завершено: 47 проблем за 2.3с                   │
└─────────────────────────────────────────────────────────────────┘
```

### Основные возможности GUI

| Функция | Описание |
|---------|----------|
| **Выбор директории** | Обзор файловой системы, быстрые кнопки |
| **Фильтрация по типу файлов** | Текст/код, документы, изображения, архивы |
| **Настройки сканирования** | Макс. размер, параллельность, исключения |
| **Реал-тайм прогресс** | Прогресс-бар, счётчики, время |
| **Фильтрация результатов** | По имени файла, по уровню серьёзности |
| **Групповой выбор** | Выбрать все, по критичности |
| **Просмотр деталей** | Контекст, позиция, маскированные данные |
| **Экспорт отчётов** | JSON, CSV, TXT форматы |
| **Шифрование файлов** | AES-256 с генерацией пароля |

### Интерфейс командной строки (CLI)

```bash
# Основные команды
data-leak-locator scan -dir /path/to/project      # Сканирование
data-leak-locator encrypt -output secrets.zip file1.txt  # Шифрование
data-leak-locator help                             # Справка

# Опции сканирования
-dir string       Директория для сканирования (обязательно)
-output string    Директория для отчётов (по умолчанию: .)
-max-size int     Максимальный размер файла в байтах (по умолчанию: 100МБ)
-verbose          Подробный вывод
-ocr              Включить OCR для изображений
-docs             Сканировать документы (PDF, DOCX, XLSX)
-archives         Сканировать содержимое архивов
-ai               Включить AI-анализ
-ai-model string  Модель Ollama (по умолчанию: llama3.2)

# Примеры использования
data-leak-locator scan -dir ./src -docs -archives -verbose
data-leak-locator scan -dir ./data -ocr -ai -ai-model mistral
data-leak-locator encrypt -dir /sensitive -output backup.zip -generate-password
```

---

## 8. Тестирование

### Структура тестов

Проект использует **встроенный тестовый фреймворк Go** с организацией тестов по модулям:

```
project/
├── searcher/
│   ├── scanner_test.go           # Тесты сканера
│   ├── patterns_test.go          # Тесты паттернов
│   ├── patterns_comprehensive_test.go  # Расширенные тесты
│   ├── entropy_test.go           # Тесты энтропии
│   ├── luhn_test.go              # Тесты алгоритма Луна
│   ├── ignorelist_test.go        # Тесты игнорирования
│   ├── risk_scorer_test.go       # Тесты оценки рисков
│   ├── image_analyzer_test.go    # Тесты анализа изображений
│   ├── document_detector_test.go # Тесты документов
│   ├── benchmark_test.go         # Бенчмарки
│   └── integration_test.go       # Интеграционные тесты
├── encryptor/
│   ├── encryptor_test.go         # Тесты шифрования
│   ├── benchmark_test.go         # Бенчмарки шифрования
│   └── integration_test.go       # Интеграционные тесты
├── gui/controller/
│   └── controller_test.go        # Тесты GUI контроллера
└── cmd/gui/
    └── main_test.go              # Тесты GUI приложения
```

### Модульные тесты (Unit Tests)

**Примеры покрытых сценариев:**

| Модуль | Тестируемые сценарии |
|--------|----------------------|
| **Scanner** | Обнаружение API-ключей, паролей, карт, приватных ключей |
| **Patterns** | Валидация всех regex-паттернов |
| **Encryptor** | Шифрование/дешифрование, генерация паролей, безопасное удаление |
| **Entropy** | Корректность вычисления энтропии |
| **Luhn** | Валидация номеров банковских карт |

**Запуск тестов:**

```bash
# Все тесты
make test

# С покрытием
make test-all

# Конкретный модуль
make test-encryptor
make test-gui

# Бенчмарки
make bench
make bench-encryptor
```

### Интеграционные тесты

Интеграционные тесты проверяют взаимодействие компонентов:

1. **Сканирование реальных тестовых файлов**
   - Директория `testdata/` содержит образцы файлов
   - Проверка обнаружения всех типов секретов

2. **End-to-end шифрование**
   - Шифрование → Дешифрование → Сравнение содержимого

3. **Обработка документов**
   - PDF, DOCX, XLSX файлы в `testdata/docs/`
   - Архивы в `testdata/archives/`

### Покрытие кода

Генерация отчёта о покрытии:

```bash
make test-all
# Отчёт создаётся в build/coverage.html
```

---

## 9. Уникальность проекта

### Сравнение с аналогами

| Функция | Data Leak Locator | GitLeaks | TruffleHog | detect-secrets |
|---------|-------------------|----------|------------|----------------|
| **Локальная работа** | ✅ Полностью | ✅ | ✅ | ✅ |
| **GUI интерфейс** | ✅ Полноценный | ❌ | ❌ | ❌ |
| **Анализ документов (PDF, Office)** | ✅ | ❌ | ❌ | ❌ |
| **OCR изображений** | ✅ | ❌ | ❌ | ❌ |
| **Обнаружение паспортов** | ✅ | ❌ | ❌ | ❌ |
| **Локальный AI-анализ** | ✅ (Ollama) | ❌ | ❌ | ❌ |
| **Шифрование файлов** | ✅ AES-256 | ❌ | ❌ | ❌ |
| **Безопасное удаление** | ✅ | ❌ | ❌ | ❌ |
| **Русский язык** | ✅ | ❌ | ❌ | ❌ |
| **Кросс-платформенность** | ✅ Win/Mac/Linux | ✅ | ✅ | ✅ |

### Ключевые преимущества

1. **Комплексность** — единый инструмент для всех типов файлов
2. **Приватность** — 100% локальная работа, включая AI
3. **Удобство** — графический интерфейс для нетехнических пользователей
4. **Защита** — встроенное шифрование обнаруженных данных
5. **Локализация** — полная поддержка русского языка

---

## 10. Выводы и результаты

### Достигнутые результаты

| Метрика | Значение |
|---------|----------|
| **Поддерживаемые форматы** | 20+ (текст, документы, изображения, архивы) |
| **Паттерны обнаружения** | 20+ типов конфиденциальных данных |
| **Покрытие тестами** | 80%+ для критических модулей |
| **Платформы сборки** | Windows (amd64), macOS (amd64, arm64), Linux (amd64) |
| **Размер бинарного файла** | ~15 MB (CLI), ~25 MB (GUI) |
| **Скорость сканирования** | ~6,000+ файлов/сек (StreamingScanner) |

### Практическая ценность

**Для разработчиков:**
- Предотвращение случайного коммита секретов
- Аудит legacy-кода перед публикацией
- Интеграция в CI/CD пайплайны

**Для бизнеса:**
- Подготовка к compliance-проверкам
- Выявление нарушений политик безопасности
- Защита интеллектуальной собственности

**Для частных лиц:**
- Поиск персональных данных на диске
- Защита сканов документов
- Аудит облачных хранилищ

### Перспективы развития

1. **Расширение AI-возможностей**
   - Дообучение моделей на специфичных данных
   - Обнаружение аномалий в access-логах

2. **Интеграции**
   - Плагин для VSCode/JetBrains
   - GitHub Action
   - Slack/Telegram уведомления

3. **Новые типы анализа**
   - Аудио/видео (распознавание речи)
   - База данных (SQL-дампы)
   - Память процессов

---

## 11. Изученные технологии и навыки

### Технологии

| Категория | Технологии |
|-----------|------------|
| **Язык программирования** | Go 1.21+ |
| **GUI Framework** | Fyne v2.7 |
| **Шифрование** | AES-256 (alexmullins/zip) |
| **OCR** | Tesseract (внешняя зависимость) |
| **PDF Processing** | Poppler (pdftotext, pdftoppm) |
| **AI/LLM** | Ollama (llama3.2, llava) |
| **CI/CD** | GitHub Actions |
| **Тестирование** | Go testing, benchmarks |

### Архитектурные паттерны

- **Streaming Scanner** — обработка файлов с помощью worker pool и каналов
- **Event-driven UI** — обновление интерфейса через события
- **Strategy Pattern** — различные стратегии извлечения текста
- **Builder Pattern** — конструирование конфигурации сканера

### Приобретённые навыки

1. **Конкурентное программирование в Go**
   - Goroutines и каналы для параллельной обработки
   - Атомарные операции и мьютексы
   - Context для отмены операций

2. **Работа с бинарными форматами**
   - Парсинг ZIP, PDF, Office документов
   - Обработка изображений

3. **Регулярные выражения**
   - Оптимизация regex для производительности
   - RE2 синтаксис (без lookahead)

4. **Кросс-платформенная разработка**
   - Условная компиляция
   - Абстракция путей файловой системы
   - GUI-адаптация для разных ОС

5. **CI/CD и автоматизация**
   - GitHub Actions workflows
   - Матричная сборка для разных платформ
   - Автоматическое создание релизов

---

## 12. CI/CD: Автоматизация тестирования и сборки

### Обзор CI/CD Pipeline

Проект использует **GitHub Actions** для полной автоматизации процесса разработки:

```
┌─────────────────────────────────────────────────────────────────┐
│                    GitHub Actions Pipeline                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Push/PR ──▶ ┌──────────┐                                       │
│              │   Test   │  • go test -race -coverprofile        │
│              │  Job     │  • Upload coverage to Codecov          │
│              └────┬─────┘                                        │
│                   │ ✅                                           │
│         ┌────────┴────────┐                                     │
│         ▼                 ▼                                      │
│  ┌─────────────┐  ┌─────────────┐                               │
│  │  Build CLI  │  │  Build GUI  │                               │
│  │             │  │             │                               │
│  │ ┌─────────┐ │  │ ┌─────────┐ │                               │
│  │ │ Windows │ │  │ │ Windows │ │  (windows-latest)             │
│  │ │  amd64  │ │  │ │  amd64  │ │                               │
│  │ └─────────┘ │  │ └─────────┘ │                               │
│  │ ┌─────────┐ │  │ ┌─────────┐ │                               │
│  │ │  macOS  │ │  │ │  macOS  │ │  (macos-13, macos-14)         │
│  │ │amd64/M1 │ │  │ │amd64/M1 │ │                               │
│  │ └─────────┘ │  │ └─────────┘ │                               │
│  │ ┌─────────┐ │  │ ┌─────────┐ │                               │
│  │ │  Linux  │ │  │ │  Linux  │ │  (ubuntu-latest)              │
│  │ │  amd64  │ │  │ │  amd64  │ │                               │
│  │ └─────────┘ │  │ └─────────┘ │                               │
│  └──────┬──────┘  └──────┬──────┘                               │
│         │                │                                       │
│         └────────┬───────┘                                       │
│                  ▼                                               │
│        ┌──────────────────┐                                     │
│        │  Create Release  │  (только для тегов v*)              │
│        │                  │                                      │
│        │  • Скачать все   │                                     │
│        │    артефакты     │                                     │
│        │  • Создать       │                                     │
│        │    GitHub Release│                                     │
│        │  • Загрузить     │                                     │
│        │    бинарники     │                                     │
│        └──────────────────┘                                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Этапы Pipeline

#### 1. Test Job

```yaml
test:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-go@v4
      with:
        go-version: '1.21'
    
    # Установка системных зависимостей для GUI
    - run: sudo apt-get install -y libgl1-mesa-dev libxcursor-dev ...
    
    # Запуск тестов с race detector и покрытием
    - run: go test -v -race -coverprofile=coverage.out ./...
    
    # Загрузка покрытия в Codecov
    - uses: codecov/codecov-action@v3
```

**Что проверяется:**
- Все unit-тесты
- Race conditions (с флагом `-race`)
- Генерация отчёта о покрытии

#### 2. Build CLI Job

Кросс-компиляция CLI для всех платформ:

| Платформа | GOOS | GOARCH | Артефакт |
|-----------|------|--------|----------|
| Windows | windows | amd64 | `data-leak-locator.exe` |
| macOS Intel | darwin | amd64 | `data-leak-locator-macos-amd64` |
| macOS M1/M2 | darwin | arm64 | `data-leak-locator-macos-m1` |
| Linux | linux | amd64 | `data-leak-locator-linux` |

**Особенности:**
- CLI собирается через кросс-компиляцию на Ubuntu
- Бинарники оптимизированы (`-ldflags="-s -w"`)

#### 3. Build GUI Job

Нативная компиляция GUI на каждой платформе:

```yaml
build-gui:
  runs-on: ${{ matrix.runs-on }}
  strategy:
    matrix:
      include:
        - goos: windows
          runs-on: windows-latest
        - goos: darwin
          goarch: amd64
          runs-on: macos-13
        - goos: darwin
          goarch: arm64
          runs-on: macos-14
        - goos: linux
          runs-on: ubuntu-latest
```

**Почему нативная сборка:**
- Fyne GUI требует нативных библиотек ОС
- CGO для графических компонентов
- Оптимизация под конкретную платформу

#### 4. Create Release Job

Автоматическое создание релиза при пуше тега:

```bash
# Создание релиза
git tag v1.0.0
git push origin v1.0.0

# GitHub Actions автоматически:
# 1. Запустит тесты
# 2. Соберёт все бинарники
# 3. Создаст GitHub Release
# 4. Загрузит 8 артефактов (4 CLI + 4 GUI)
```

### Триггеры Pipeline

| Событие | Что запускается |
|---------|-----------------|
| Push в `master`, `develop`, `feature/**` | Test + Build |
| Pull Request в `master`, `develop` | Test + Build |
| Push тега `v*` | Test + Build + Release |
| `workflow_dispatch` | Ручной запуск всего pipeline |

### Кэширование

Для ускорения сборки используется кэширование Go модулей:

```yaml
- uses: actions/cache@v3
  with:
    path: |
      ~/.cache/go-build
      ~/go/pkg/mod
    key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
```

**Экономия времени:**
- Первая сборка: ~5-7 минут
- С кэшем: ~2-3 минуты

### Локальные команды сборки (Makefile)

```makefile
# Сборка обоих бинарников
make build

# Только CLI
make build-cli

# Только GUI
make build-gui

# Тесты
make test           # Все тесты
make test-all       # С покрытием
make test-encryptor # Только encryptor
make test-gui       # Только GUI

# Бенчмарки
make bench
make bench-encryptor

# Очистка
make clean
```

### Артефакты сборки

После успешной сборки создаются следующие файлы:

```
build/
├── data-leak-locator           # CLI (Linux/macOS)
├── data-leak-locator.exe       # CLI (Windows)
├── data-leak-locator-gui       # GUI (Linux)
├── data-leak-locator-gui.exe   # GUI (Windows)
├── coverage.out                # Отчёт покрытия
└── coverage.html               # HTML-версия отчёта
```

---

## 13. Теоретические основы: Утечки данных

### 13.1 Что такое утечка данных

**Утечка данных** — это инцидент безопасности, при котором конфиденциальная информация становится доступной неавторизованным лицам. Это может произойти умышленно (кибератака, инсайдерская угроза) или случайно (человеческая ошибка, неправильная конфигурация).

Типы данных, подверженных утечкам:
- **Персональные данные** — ФИО, паспортные данные, адреса, номера телефонов
- **Финансовая информация** — номера банковских карт, реквизиты счетов
- **Учётные данные** — логины, пароли, токены доступа, API-ключи
- **Корпоративные секреты** — исходный код, бизнес-планы, клиентские базы

### 13.2 Причины утечек данных

**Технические причины:**
- Хранение секретов в открытом виде в репозиториях кода
- Отсутствие шифрования при передаче и хранении данных
- Уязвимости в программном обеспечении (SQL-инъекции, XSS)
- Неправильная настройка прав доступа к файлам и базам данных
- Использование устаревших протоколов безопасности

**Человеческий фактор:**
- Случайная публикация `.env` файлов с паролями в публичные репозитории
- Отправка конфиденциальных документов по незащищённым каналам
- Использование слабых или повторяющихся паролей
- Фишинговые атаки и социальная инженерия
- Потеря или кража устройств с незашифрованными данными

**Организационные причины:**
- Отсутствие политик безопасности и регламентов работы с данными
- Недостаточное обучение сотрудников правилам информационной безопасности
- Отсутствие мониторинга и аудита доступа к данным

### 13.3 Методы предотвращения утечек

**Технические меры:**
- Регулярное сканирование кода и файлов на наличие секретов (Data Leak Locator)
- Шифрование данных при хранении (AES-256) и передаче (TLS)
- Использование менеджеров секретов (HashiCorp Vault, AWS Secrets Manager)
- Внедрение DLP-систем (Data Loss Prevention)
- Настройка `.gitignore` для исключения конфиденциальных файлов
- Многофакторная аутентификация (MFA)

**Организационные меры:**
- Принцип минимальных привилегий (доступ только к необходимым данным)
- Регулярное обучение сотрудников основам кибербезопасности
- Классификация данных по уровню конфиденциальности
- Проведение регулярных аудитов безопасности
- Разработка плана реагирования на инциденты

**Мониторинг и контроль:**
- Интеграция проверок безопасности в CI/CD pipeline
- Pre-commit хуки для блокировки коммитов с секретами
- Логирование и анализ подозрительной активности

---

## 14. Результаты тестирования

### 14.1 Функциональные тесты

**Модуль сканирования (`searcher`):**
- Обнаружение паролей в форматах `password=`, `pwd:`, переменных окружения
- Детектирование API-ключей (AWS, GitHub, Stripe, Google)
- Валидация номеров банковских карт (Visa, MasterCard, Amex) с проверкой по алгоритму Луна
- Распознавание приватных ключей (RSA, SSH, PGP)
- Поиск JWT-токенов, строк подключения к БД
- Корректность вычисления энтропии строк
- Работа списка игнорирования (false positive reduction)

**Модуль шифрования (`encryptor`):**
- Создание зашифрованных архивов с корректным паролем
- Расшифровка архивов и сравнение с оригиналом
- Генерация криптографически стойких паролей
- Многопроходное безопасное удаление файлов
- Валидация паролей (длина, символы)

**Модуль обработки документов:**
- Извлечение текста из PDF (текстовых и сканированных)
- Парсинг DOCX и XLSX файлов
- Рекурсивное сканирование ZIP/TAR/GZIP архивов

**GUI-контроллер:**
- Инициализация и старт/стоп сканирования
- Обновление прогресса и статистики
- Фильтрация результатов
- Экспорт отчётов в разных форматах

### 14.2 Стресс-тесты и производительность

**Тестовая среда:**
- CPU: Intel Xeon E5-2660 @ 2.20GHz (16 потоков)
- OS: Windows 10

**Параметры программы:**

| Параметр | Значение |
|----------|----------|
| Максимальный размер файла | 100 MB (по умолчанию, настраивается) |
| Параллельные воркеры | 16 (по умолчанию, настраивается) |
| Глубина вложенности архивов | До 10 уровней |
| Потребление памяти (без AI) | 50-150 MB |
| Потребление памяти с AI-анализом | 2-4 GB (зависит от модели Ollama) |

**Результаты бенчмарков сканирования (StreamingScanner):**

| Тест | Время | Пропускная способность |
|------|-------|------------------------|
| 100 маленьких файлов (~3 KB) | ~16 мс | ~6,200 файлов/сек |
| Потоковое сканирование ~5 MB | ~1.1 сек | 4.26 MB/s |
| 200 файлов с секретами (~6 KB) | ~21 мс | ~9,500 файлов/сек |

**Результаты бенчмарков шифрования (AES-256):**

| Размер данных | Время | Скорость |
|---------------|-------|----------|
| 1 MB | ~72 мс | 14.5 MB/s |
| 10 MB | ~670 мс | 15.6 MB/s |
| 50 MB | ~3.1 сек | 17.2 MB/s |
| 100 MB | ~6.4 сек | 16.5 MB/s |
| 1 GB (расчётно) | ~60 сек | ~17 MB/s |

**Бенчмарки критических операций:**

| Операция | Время (ns/op) | Сложность |
|----------|---------------|-----------|
| Проверка regex-паттернов (8 строк) | ~529,000 | O(n·m) |
| Вычисление энтропии строки | ~5,900 | O(n) |
| Валидация карты (Luhn) | ~239 | O(n) |
| Расчёт риска | ~6,400 | O(k) |
| Генерация пароля | ~656 | O(n) |
| Безопасное удаление 1 MB | ~32 мс | O(n·p) |

---

## Приложения

### A. Системные требования

| Компонент | Минимум | Рекомендуется |
|-----------|---------|---------------|
| **ОС** | Windows 10, macOS 10.15, Ubuntu 20.04 | Последние версии |
| **ОЗУ** | 512 MB | 2+ GB (для AI) |
| **Диск** | 100 MB | 500 MB (с моделями AI) |
| **Go** | 1.21+ | 1.22+ |

**Опциональные зависимости:**
- **Tesseract OCR** — для распознавания изображений
- **Poppler** — для обработки PDF
- **Ollama** — для локального AI-анализа

### B. Установка зависимостей

**macOS:**
```bash
brew install tesseract tesseract-lang poppler
brew install ollama && ollama pull llama3.2
```

**Ubuntu/Debian:**
```bash
sudo apt install tesseract-ocr tesseract-ocr-rus poppler-utils
curl -fsSL https://ollama.com/install.sh | sh
ollama pull llama3.2
```

**Windows:**
```powershell
# Tesseract: https://github.com/UB-Mannheim/tesseract/wiki
# Poppler: https://github.com/oschwartz10612/poppler-windows/releases
# Ollama: https://ollama.com/download
```

### C. Быстрый старт

```bash
# Клонирование
git clone https://github.com/kacebover/password-finder.git
cd password-finder

# Сборка
make build

# Запуск CLI
./build/data-leak-locator scan -dir /путь/к/проекту

# Запуск GUI
./build/data-leak-locator-gui
```

---

## Приложение Д. Листинги исходного кода

### Приложение Д.1 — Определение паттернов для обнаружения секретов

```go
// patterns.go — Определение типов паттернов и regex для обнаружения
// PatternType представляет категорию обнаруженных конфиденциальных данных
type PatternType string
const (
    // Учётные данные
    PatternPassword    PatternType = "password"
    PatternAPIKey      PatternType = "api_key"
    PatternToken       PatternType = "token"
    PatternPrivateKey  PatternType = "private_key"
    PatternAWSKey      PatternType = "aws_key"
    PatternGitHubToken PatternType = "github_token"
    // Персональные данные
    PatternEmail       PatternType = "email"
    PatternPhoneNumber PatternType = "phone_number"
    PatternSSN         PatternType = "ssn"
    PatternPassport    PatternType = "passport"
    // Финансовые данные
    PatternCreditCard PatternType = "credit_card"
    PatternIBAN       PatternType = "iban"
)
// NewPatterns создаёт новый экземпляр Patterns со всеми предопределёнными паттернами
func NewPatterns() *Patterns {
    p := &Patterns{patterns: make([]*Pattern, 0)}
    // Паттерны учётных данных
    p.addPattern(PatternPassword, `(?i)(password\s*[=:]\s*['"]?[^\s'";]+['"]?)`, Critical, "Password assignment detected")
    p.addPattern(PatternAPIKey, `(?i)(api[_-]?key\s*[=:]\s*['"]?[^\s'";]{20,}['"]?)`, Critical, "API Key detected")
    p.addPattern(PatternToken, `(?i)(token\s*[=:]\s*['"]?[A-Za-z0-9\-_.]{20,}['"]?)`, Critical, "Authentication token detected")
    p.addPattern(PatternPrivateKey, `-----BEGIN\s+(RSA\s+)?PRIVATE\s+KEY`, Critical, "Private key detected")
    p.addPattern(PatternAWSKey, `(AKIA[0-9A-Z]{16})`, Critical, "AWS Access Key detected")
    p.addPattern(PatternGitHubToken, `(gh[pousr]_[A-Za-z0-9_]{36,255})`, Critical, "GitHub token detected")
    // Паттерны персональных данных
    p.addPattern(PatternEmail, `\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b`, Medium, "Email address detected")
    p.addPattern(PatternPhoneNumber, `(?:\+?1[-.\s]?)?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}\b`, Medium, "Phone number detected")
    // Паттерн SSN — Go RE2 не поддерживает lookahead, поэтому используем упрощённый паттерн
    // Соответствует XXX-XX-XXXX, где первая цифра 0-8 (исключает 9xx и охватывает большинство валидных SSN)
    p.addPattern(PatternSSN, `\b[0-8]\d{2}-[0-9]{2}-[0-9]{4}\b`, High, "Social Security Number detected")
    p.addPattern(PatternPassport, `(?i)passport\s*[:=]\s*([A-Z]{1,2}[0-9]{6,9})`, High, "Passport number detected")
    // Паттерны финансовых данных
    p.addPattern(PatternCreditCard, `\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12})\b`,
     Critical, "Credit card number detected")
    p.addPattern(PatternIBAN, `\b[A-Z]{2}[0-9]{2}[A-Z0-9]{1,30}\b`, High, "IBAN detected")
    p.addPattern(PatternBIC, `\b[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?\b`, Medium, "BIC code detected")
    // Паттерны конфигураций и секретов
    p.addPattern(PatternEnvVar, `(?i)export\s+[A-Z_][A-Z0-9_]*\s*=\s*['"]?[^\s'";]+['"]?`, High, "Environment variable assignment detected")
    p.addPattern(PatternJSONSecret, `(?i)(["\']?(api_key|password|secret|token|private_key|access_key)["\']?\s*:\s*["\']?[A-Za-z0-9\-_.]{8,}["\']?)`,
     High, "JSON secret detected")
    p.addPattern(PatternYAMLSecret, `(?i)([a-z_]+_key|secret|password)\s*:\s*[A-Za-z0-9\-_.]{8,}`, High, "YAML secret detected")
    // Захардкоженные секреты
    p.addPattern(PatternConnectionStr, `(?i)(connection_string|database_url|db_connection)\s*[=:]\s*['"]?[^\s'";]+['"]?`,
     High, "Connection string detected")
    p.addPattern(PatternHardcodedSecret, `(?i)(secret|api_secret|private_secret)\s*[=:]\s*['"]?[A-Za-z0-9\-_.=+/]{16,}['"]?`,
     Critical, "Hardcoded secret detected")
    return p
}
```

---

### Приложение Д.2 — Вычисление энтропии строки

```go
// entropy.go — Вычисление энтропии по формуле Шеннона
// EntropyCalculator вычисляет энтропию Шеннона для строк
type EntropyCalculator struct {
    minLength            int
    highEntropyThreshold float64
}
// NewEntropyCalculator создаёт новый калькулятор энтропии
func NewEntropyCalculator() *EntropyCalculator {
    return &EntropyCalculator{
        minLength:            8,
        highEntropyThreshold: 4.5,
    }
}
// CalculateEntropy вычисляет энтропию Шеннона для заданной строки
// Высокая энтропия (>4.5) обычно указывает на случайные/зашифрованные данные, такие как токены или ключи
func (ec *EntropyCalculator) CalculateEntropy(text string) float64 {
    if len(text) < ec.minLength {
        return 0
    }
    // Подсчёт частоты символов
    frequencies := make(map[rune]int)
    for _, char := range text {
        frequencies[char]++
    }
    // Вычисление энтропии Шеннона: H(X) = -Σ p(x) × log₂(p(x))
    entropy := 0.0
    length := float64(len(text))
    for _, count := range frequencies {
        if count == 0 {
            continue
        }
        frequency := float64(count) / length
        entropy -= frequency * math.Log2(frequency)
    }
    return entropy
}
// IsHighEntropy возвращает true, если строка имеет высокую энтропию (вероятно, секрет/токен)
func (ec *EntropyCalculator) IsHighEntropy(text string) bool {
    return ec.CalculateEntropy(text) >= ec.highEntropyThreshold
}
```

---

### Приложение Д.3 — Worker Pool для параллельной обработки файлов

```go
// scanner_streaming.go — Параллельная обработка с использованием горутин
// Scan запускает сканирование с контекстом для отмены
func (ss *StreamingScanner) Scan(ctx context.Context, rootDir string) (*ScanResult, error) {
    ss.startTime = time.Now()
    ss.state.Store(int32(StateRunning))
    ss.result = NewScanResult()
    // Создание пула воркеров
    fileChan := make(chan string, 1000)
    var wg sync.WaitGroup
    // Запуск воркеров (N горутин для параллельной обработки)
    for i := 0; i < ss.maxConcurrent; i++ {
        wg.Add(1)
        go ss.worker(ctx, fileChan, &wg)
    }
    // Запуск обхода директорий в отдельной горутине
    go func() {
        defer close(fileChan)
        ss.walkDirectory(ctx, rootDir, fileChan)
    }()
    // Ожидание завершения всех воркеров
    wg.Wait()
    // Финализация результата
    ss.result.EndTime = time.Now().Unix()
    ss.result.FilesScanned = int(ss.filesProcessed.Load())
    return ss.result, nil
}
```

---

### Приложение Д.4 — Парсер машиночитаемой зоны паспорта (MRZ)

```go
// mrz_parser.go — Парсинг MRZ по стандарту ICAO 9303
// MRZType представляет тип MRZ
type MRZType int
const (
    MRZTypeTD1 MRZType = iota // ID карта (3 строки, 30 символов)
    MRZTypeTD2                 // Проездной документ (2 строки, 36 символов)
    MRZTypeTD3                 // Паспорт (2 строки, 44 символа)
)
// ParsedMRZ содержит полностью распарсенные данные MRZ с валидацией
type ParsedMRZ struct {
    Type           MRZType
    Surname        string
    GivenNames     string
    DocumentNumber string
    DateOfBirth    string   // ГГММДД
    ExpiryDate     string   // ГГММДД
    IsValid        bool
    ValidationScore float64 // 0-100
}
// NewMRZParser создаёт новый парсер MRZ
func NewMRZParser() *MRZParser {
    parser := &MRZParser{charWeights: make(map[rune]int)}
    // Инициализация весов символов (ICAO 9303)
    // 0-9 = 0-9, A-Z = 10-35, < = 0
    for i := 0; i <= 9; i++ {
        parser.charWeights[rune('0'+i)] = i
    }
    for i := 0; i < 26; i++ {
        parser.charWeights[rune('A'+i)] = 10 + i
    }
    parser.charWeights['<'] = 0
    return parser
}
```

---

### Приложение Д.5 — Шифрование файлов AES-256

```go
// encryptor.go — Создание зашифрованного ZIP-архива
// addFileToArchive добавляет один файл в ZIP-архив с шифрованием AES-256
func (e *Encryptor) addFileToArchive(zipWriter *zip.Writer, file FileEntry) error {
    // Открытие исходного файла
    srcFile, err := os.Open(file.SourcePath)
    if err != nil {
        return fmt.Errorf("failed to open file: %w", err)
    }
    defer srcFile.Close()
    // Создание зашифрованного writer для этого файла
    // Библиотека alexmullins/zip использует шифрование AES-256 по умолчанию
    writer, err := zipWriter.Encrypt(file.ArchivePath, e.config.Password)
    if err != nil {
        return fmt.Errorf("failed to create encrypted entry: %w", err)
    }
    // Копирование содержимого файла с отслеживанием прогресса
    buf := make([]byte, e.config.BufferSize)
    for {
        n, readErr := srcFile.Read(buf)
        if n > 0 {
            _, writeErr := writer.Write(buf[:n])
            if writeErr != nil {
                return fmt.Errorf("failed to write: %w", writeErr)
            }
            atomic.AddInt64(&e.bytesProcessed, int64(n))
        }
        if readErr == io.EOF {
            break
        }
    }
    return nil
}
```

---

### Приложение Д.6 — Безопасное удаление файлов

```go
// encryptor.go — Многопроходная перезапись файла перед удалением
// SecureDelete безопасно удаляет файл, перезаписывая его несколько раз
func SecureDelete(filePath string, passes int) error {
    file, err := os.OpenFile(filePath, os.O_WRONLY, 0)
    if err != nil {
        return err
    }
    info, _ := file.Stat()
    size := info.Size()
    buf := make([]byte, 32*1024)
    // Выполнение проходов перезаписи
    for pass := 0; pass < passes; pass++ {
        file.Seek(0, 0)
        // Определение паттерна для этого прохода
        var pattern byte
        switch pass % 3 {
        case 0:
            pattern = 0x00 // Нули
        case 1:
            pattern = 0xFF // Единицы
        case 2:
            // Случайные данные
            rand.Read(buf)
        }
        // Заполнение буфера паттерном (если не случайные данные)
        if pass%3 != 2 {
            for i := range buf {
                buf[i] = pattern
            }
        }
        // Запись паттерна во весь файл
        remaining := size
        for remaining > 0 {
            writeSize := int64(len(buf))
            if remaining < writeSize {
                writeSize = remaining
            }
            file.Write(buf[:writeSize])
            remaining -= writeSize
        }
        file.Sync() // Синхронизация с диском после каждого прохода
    }
    file.Close()
    return os.Remove(filePath)
}
```

---

### Приложение Д.7 — Криптографическая генерация паролей

```go
// encryptor.go — Генерация безопасных паролей с использованием crypto/rand

// GeneratePassword генерирует криптографически стойкий случайный пароль
func GeneratePassword(length int) (string, error) {
    if length < 8 {
        length = 8
    }
    if length > 128 {
        length = 128
    }

    // Набор символов для генерации пароля
    const charset = "abcdefghijklmnopqrstuvwxyz" +
                    "ABCDEFGHIJKLMNOPQRSTUVWXYZ" +
                    "0123456789" +
                    "!@#$%^&*()-_=+[]{}|;:,.<>?"

    password := make([]byte, length)
    randomBytes := make([]byte, length)

    // Использование криптографически стойкого генератора случайных чисел
    if _, err := rand.Read(randomBytes); err != nil {
        return "", fmt.Errorf("failed to generate random bytes: %w", err)
    }

    for i := 0; i < length; i++ {
        password[i] = charset[randomBytes[i]%byte(len(charset))]
    }

    return string(password), nil
}
```

---

**© 2024 Data Leak Locator Project**

*Документация актуальна для версии 1.0.0*
